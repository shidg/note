curl -fLO https://storage.googleapis.com/kubernetes-release/release/v1.22.9/kubernetes-src.tar.gz
mkdir -p /root/kubernetes
tar zxvf kubernetes-src.tar.gz -C /root/kubernetes


修改时间
#替换命令
sed -i "s/365/365 * 50/" /root/kubernetes/cmd/kubeadm/app/constants/constants.go
sed -i "s/* 10/* 50/p" /root/kubernetes/staging/src/k8s.io/client-go/util/cert/cert.go
查看
cat /root/kubernetes/cmd/kubeadm/app/constants/constants.go|grep "CertificateValidity ="
CertificateValidity = time.Hour * 24 * 365 * 50


查看 kube-cross 的 TAG 版本号 

cat /root/kubernetes/build/build-image/cross/VERSION
v1.22.0-go1.16.15-buster.0
 

本地安装go环境

# 安装依赖
yum install gcc make -y
yum install rsync jq -y

# 下载go安装包
wget https://dl.google.com/go/go1.16.15.linux-amd64.tar.gz
或者
wget https://golang.google.cn/dl/go1.16.15.linux-amd64.tar.gz

# 解压
tar zxvf go1.16.15.linux-amd64.tar.gz  -C /usr/local

# 设置环境变量
export GOROOT=/usr/local/go
export GOPATH=/usr/local/gopath
export PATH=$PATH:$GOROOT/bin

# 环境变量永久生效
source /etc/profile


编译

# 进入源码目录
cd /root/kubernetes

# 编译kubeadm, 这里主要编译kubeadm 即可
make all WHAT=cmd/kubeadm GOFLAGS=-v

# 文件位置
cd /root/kubernetes/_output/local/bin/linux/amd64

# 集群初试化之前替换掉kubeadm

# 查询需要的镜像版本
kubeadm config images list
# 查询证书有效期
kubeadm certs check-expiration
